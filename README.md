# MGC

## Contents

- [Overview](#overview)
- [Repo Contents](#repo-contents)
- [System Requirements](#system-requirements)
- [Installation Guide](#installation-guide)
- [Demo](#demo)
- [License](./LICENSE)
- [Issues](https://github.com/neurodata/mgc/issues)
- [Usage](#usage)
- [Pseudocode](#pseudocode)

# Overview

In modern scientific discovery, it is becoming increasingly critical to uncover whether one property of a dataset is related to another. The `MGC` (pronounced *magic*), or Multiscale Generalized Correlation, provides a framework for investigation into the relationships between properties of a dataset and the underlying geometries of the relationships, all while requiring sample sizes feasible in real data scenarios.

# Repo Contents

- [R](./R): `R` package code.
- [docs](./docs): package documentation.
- [man](./man): package manual for help in R session.
- [tests](./tests): `R` unit tests written using the `testthat` package.
- [vignettes](./vignettes): `R` vignettes for R session html help pages.

This package is supported for *Linux*, *Mac OSX*, and *Windows* operating systems.

# System Requirements

Before setting up the MGC package, users should have R version 3.4.0 or higher, and several packages set up from CRAN.

## Installing R version 3.4.2 on Ubuntu

the latest version of R can be installed by adding the latest repository to `apt`:

```
sudo echo "deb http://cran.rstudio.com/bin/linux/ubuntu xenial/" | sudo tee -a /etc/apt/sources.list
gpg --keyserver keyserver.ubuntu.com --recv-key E084DAB9
gpg -a --export E084DAB9 | sudo apt-key add -
sudo apt-get update
sudo apt-get install r-base r-base-dev
```

## Package dependencies

### Required

From inside an `R` session, we can install the `MGC` dependencies with the following command:

```
install.packages(c('ggplot2', 'reshape2', 'Rmisc'))  # set up package dependencies
```

### Optional

If the user wishes to use the interactive demos (`R` vignettes) or run the tests, then the following packages must also be set up:

```
install.packages(c('testthat', 'knitr', 'rmarkdown'))
```

# Installation Guide

From inside an `R` session, we must first install and source `devtools`:

```
install.packages('devtools')  # set up devtools
require(devtools)  # source it
```

## No Vignettes

From the same `R` session, type:

```
install_github('neurodata/mgc')  # install MGC
require(MGC)  # source the package now that it is set up
```

## Vignettes

From the same `R` session, type:

```
install_github('neurodata/mgc', build_vignettes=TRUE)  # install MGC with the vignettes
require(MGC)  # source the package now that it is set up
vignette("MGC Statistic", package="MGC")  # view one of the basic vignettes
```

The package should take approximately 8 seconds on a standard computer (4 cores @ 3.3 GHz/core, 16 GB RAM with internet at least 25 Mbps). 

# Demo

The `MGC` demo can be run as follows:

```
require(MGC)
set.seed(12345)
mgc.sample(MGC::test_xunif, MGC::test_ylin)  # test with a linear relationship between x and y
```

and is expected  to produce the following result exactly approximately *instantaneously*:

```$statMGC
[1] 0.891153

$localCorr
      [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]      [,8]      [,9]     [,10]     [,11]     [,12]     [,13]     [,14]     [,15]     [,16]     [,17]
 [1,]    0 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [2,]    0 0.1951784 0.2928682 0.3333446 0.2903246 0.2976125 0.2892421 0.3005644 0.3055273 0.2924717 0.2906977 0.3003379 0.2940036 0.2959624 0.2947281 0.2924608 0.2948871
 [3,]    0 0.1639473 0.3071989 0.3832862 0.3642466 0.3961425 0.3922938 0.4142681 0.4095460 0.4033917 0.4080663 0.4268586 0.4186127 0.4181841 0.4182948 0.4131061 0.4152916
 [4,]    0 0.2091909 0.3342447 0.3850069 0.3863381 0.4319838 0.4289443 0.4417240 0.4341866 0.4278219 0.4285078 0.4454284 0.4493498 0.4497137 0.4486309 0.4452312 0.4484339
 [5,]    0 0.2176064 0.3449160 0.4028795 0.4270345 0.4594815 0.4668840 0.4924692 0.4900685 0.4836761 0.4991803 0.5092013 0.5181188 0.5155987 0.5116281 0.5084044 0.5122601
 [6,]    0 0.2385879 0.3727564 0.4230191 0.4728743 0.5060678 0.5232186 0.5490421 0.5499062 0.5435841 0.5590211 0.5697416 0.5855821 0.5866188 0.5820125 0.5786904 0.5800304
 [7,]    0 0.2235201 0.3613457 0.4111100 0.4738783 0.5025901 0.5199122 0.5481388 0.5612069 0.5567502 0.5705186 0.5771842 0.5973747 0.6042868 0.6001331 0.5968302 0.5986981
 [8,]    0 0.2233368 0.3670055 0.4298873 0.4856599 0.5161647 0.5455360 0.5705364 0.5836325 0.5792099 0.5953984 0.6033209 0.6252310 0.6345047 0.6319407 0.6271918 0.6284445
 [9,]    0 0.2226187 0.3498386 0.4121934 0.4673374 0.5054834 0.5372477 0.5647736 0.5740773 0.5673609 0.5809769 0.5884480 0.6155118 0.6253222 0.6212408 0.6169326 0.6180716
[10,]    0 0.2276537 0.3586806 0.4374676 0.4909362 0.5385431 0.5693247 0.6003540 0.6153517 0.6085187 0.6226241 0.6288543 0.6557130 0.6652358 0.6641856 0.6635150 0.6632226
[11,]    0 0.2333443 0.3597458 0.4386621 0.4937125 0.5378146 0.5706962 0.6039230 0.6193594 0.6188996 0.6346548 0.6403158 0.6711864 0.6834806 0.6821938 0.6809895 0.6807700
[12,]    0 0.2369665 0.3604826 0.4353122 0.4976191 0.5385307 0.5754280 0.6103595 0.6245318 0.6256241 0.6422441 0.6492798 0.6818856 0.6969844 0.6985620 0.6983279 0.7009549
[13,]    0 0.2376538 0.3616739 0.4380875 0.5017418 0.5443173 0.5806917 0.6158055 0.6301991 0.6306952 0.6465323 0.6545138 0.6895732 0.7073479 0.7107383 0.7095108 0.7127132
[14,]    0 0.2393725 0.3638641 0.4391772 0.5018831 0.5444724 0.5841605 0.6221175 0.6373049 0.6408280 0.6559574 0.6641481 0.7006837 0.7177410 0.7224135 0.7221223 0.7252182
[15,]    0 0.2550575 0.3760433 0.4495321 0.5087872 0.5487632 0.5882174 0.6303959 0.6450565 0.6488285 0.6637483 0.6752595 0.7105409 0.7275444 0.7322049 0.7318082 0.7367978
[16,]    0 0.2551982 0.3805320 0.4564039 0.5208801 0.5616527 0.6053425 0.6456695 0.6604927 0.6676514 0.6810005 0.6924585 0.7278958 0.7460430 0.7497374 0.7501137 0.7547021
[17,]    0 0.2551355 0.3849562 0.4612732 0.5235249 0.5656531 0.6077673 0.6467735 0.6630489 0.6714767 0.6847825 0.6963010 0.7308284 0.7509908 0.7552396 0.7565769 0.7613669
[18,]    0 0.2591992 0.3862787 0.4609151 0.5264532 0.5688428 0.6107210 0.6523371 0.6706448 0.6794112 0.6916629 0.7033629 0.7371200 0.7572133 0.7621691 0.7656424 0.7708365
[19,]    0 0.2596990 0.3869396 0.4617053 0.5262469 0.5701426 0.6125269 0.6540979 0.6723193 0.6802419 0.6917472 0.7045107 0.7377139 0.7582206 0.7630948 0.7659963 0.7706791
[20,]    0 0.2639147 0.3888085 0.4633998 0.5299781 0.5735913 0.6174471 0.6601938 0.6806776 0.6883238 0.7002447 0.7131856 0.7457578 0.7664698 0.7727585 0.7762137 0.7804027
          [,18]     [,19]     [,20]     [,21]     [,22]     [,23]     [,24]     [,25]     [,26]     [,27]     [,28]     [,29]     [,30]     [,31]     [,32]     [,33]     [,34]
 [1,] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [2,] 0.2907181 0.2864633 0.2846686 0.2863452 0.2928700 0.2995692 0.2993991 0.2982186 0.2974471 0.2976227 0.2969307 0.2964224 0.2962057 0.2959958 0.2957918 0.2959196 0.2930548
 [3,] 0.4125052 0.4068546 0.4046521 0.4036727 0.4087620 0.4115097 0.4109085 0.4093595 0.4101757 0.4099107 0.4089754 0.4082533 0.4079128 0.4075489 0.4071627 0.4072168 0.4047485
 [4,] 0.4471668 0.4474045 0.4445403 0.4421461 0.4459247 0.4491844 0.4489663 0.4478316 0.4491497 0.4486065 0.4475400 0.4466988 0.4464282 0.4462106 0.4460426 0.4463969 0.4445161
 [5,] 0.5110427 0.5110650 0.5085622 0.5050910 0.5111928 0.5129317 0.5128866 0.5113729 0.5121823 0.5114394 0.5102182 0.5092931 0.5089972 0.5087714 0.5086115 0.5090519 0.5072830
 [6,] 0.5773437 0.5757675 0.5755159 0.5741856 0.5795121 0.5801314 0.5804452 0.5786061 0.5792348 0.5783230 0.5769445 0.5760672 0.5757262 0.5754596 0.5749967 0.5754785 0.5736887
 [7,] 0.5948391 0.5927432 0.5939455 0.5925792 0.5967313 0.5970494 0.5979925 0.5960977 0.5979942 0.5978445 0.5971676 0.5962871 0.5957127 0.5955601 0.5952864 0.5959861 0.5934567
 [8,] 0.6282426 0.6250018 0.6263670 0.6272500 0.6309917 0.6305425 0.6321370 0.6301254 0.6316579 0.6314921 0.6306727 0.6296644 0.6291329 0.6290476 0.6283967 0.6292628 0.6269740
 [9,] 0.6176031 0.6160032 0.6175763 0.6195340 0.6228254 0.6227330 0.6240134 0.6235490 0.6256335 0.6261486 0.6260562 0.6251173 0.6247195 0.6248397 0.6245198 0.6248665 0.6231261
[10,] 0.6635975 0.6609965 0.6620238 0.6644682 0.6683773 0.6684416 0.6694493 0.6686941 0.6706937 0.6710397 0.6715547 0.6712533 0.6708509 0.6709787 0.6707005 0.6711535 0.6694528
[11,] 0.6802145 0.6784501 0.6802614 0.6820245 0.6853803 0.6849419 0.6867308 0.6861411 0.6882684 0.6887783 0.6895578 0.6892740 0.6889474 0.6891656 0.6891413 0.6899110 0.6885759
[12,] 0.7000812 0.7003877 0.7016158 0.7027434 0.7055949 0.7053661 0.7068617 0.7071125 0.7099417 0.7104314 0.7111080 0.7108306 0.7105801 0.7109435 0.7109570 0.7114123 0.7103883
[13,] 0.7120814 0.7122833 0.7144105 0.7164058 0.7193103 0.7186477 0.7198539 0.7199612 0.7225802 0.7230774 0.7236701 0.7233883 0.7227423 0.7232876 0.7235642 0.7238326 0.7225671
[14,] 0.7248747 0.7243429 0.7264742 0.7284989 0.7314097 0.7308524 0.7323377 0.7321993 0.7351721 0.7356293 0.7361445 0.7358920 0.7352376 0.7359524 0.7361372 0.7367090 0.7358004
[15,] 0.7364821 0.7359131 0.7395388 0.7415367 0.7449433 0.7452876 0.7469384 0.7471230 0.7499203 0.7507333 0.7514451 0.7512120 0.7505526 0.7514139 0.7516594 0.7521139 0.7515121
[16,] 0.7545513 0.7546604 0.7585830 0.7611969 0.7642366 0.7651333 0.7671244 0.7677794 0.7704250 0.7712633 0.7722382 0.7719813 0.7713146 0.7722245 0.7726311 0.7731709 0.7724820
[17,] 0.7612474 0.7614681 0.7653490 0.7688802 0.7723152 0.7730908 0.7752914 0.7761486 0.7789993 0.7797268 0.7807588 0.7805400 0.7799167 0.7806431 0.7812911 0.7821188 0.7817779
[18,] 0.7701493 0.7705065 0.7739684 0.7781592 0.7816051 0.7829047 0.7850172 0.7862830 0.7892562 0.7899925 0.7909766 0.7907888 0.7902419 0.7911151 0.7918344 0.7927769 0.7922700
[19,] 0.7704081 0.7722911 0.7755965 0.7794672 0.7826205 0.7836818 0.7855911 0.7866922 0.7900178 0.7907020 0.7917578 0.7916052 0.7909978 0.7920729 0.7928121 0.7936315 0.7931237
[20,] 0.7796988 0.7818721 0.7854304 0.7890094 0.7922915 0.7932452 0.7951805 0.7964228 0.7997515 0.8003625 0.8014534 0.8015784 0.8012047 0.8023808 0.8031151 0.8041101 0.8034771
          [,35]     [,36]     [,37]     [,38]     [,39]     [,40]     [,41]     [,42]     [,43]     [,44]     [,45]     [,46]     [,47]     [,48]     [,49]     [,50]
 [1,] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [2,] 0.2930689 0.2918624 0.2916961 0.2914093 0.2896516 0.2881410 0.2861289 0.2834501 0.2793400 0.2746709 0.2685539 0.2622071 0.2557104 0.2494733 0.2418270 0.2346040
 [3,] 0.4045811 0.4026934 0.4022072 0.4015576 0.3988519 0.3964830 0.3934145 0.3894233 0.3834360 0.3766739 0.3679253 0.3588709 0.3496302 0.3407547 0.3299406 0.3197105
 [4,] 0.4447368 0.4431432 0.4431644 0.4430000 0.4406305 0.4386407 0.4358977 0.4321452 0.4262423 0.4194946 0.4105364 0.4012173 0.3916488 0.3824669 0.3711389 0.3604541
 [5,] 0.5075817 0.5058185 0.5059070 0.5057828 0.5031484 0.5009484 0.4978906 0.4936813 0.4870227 0.4794008 0.4692528 0.4586902 0.4478377 0.4374247 0.4245606 0.4124308
 [6,] 0.5740015 0.5719779 0.5720437 0.5718694 0.5688531 0.5663273 0.5628306 0.5580312 0.5504595 0.5417980 0.5302815 0.5182976 0.5059887 0.4941777 0.4795958 0.4658442
 [7,] 0.5929233 0.5911922 0.5916746 0.5919047 0.5892400 0.5870892 0.5839472 0.5794631 0.5721482 0.5637126 0.5523078 0.5404018 0.5281267 0.5163550 0.5017098 0.4879230
 [8,] 0.6259734 0.6235525 0.6243232 0.6248250 0.6223007 0.6203227 0.6173071 0.6128788 0.6054864 0.5969156 0.5852017 0.5729475 0.5602833 0.5481427 0.5329653 0.5186936
 [9,] 0.6207246 0.6189514 0.6203923 0.6215593 0.6197924 0.6185788 0.6163557 0.6127371 0.6062327 0.5985683 0.5877538 0.5763736 0.5645325 0.5531925 0.5388226 0.5253523
[10,] 0.6672299 0.6653854 0.6663704 0.6676166 0.6657107 0.6643989 0.6620026 0.6581073 0.6511117 0.6428699 0.6312450 0.6190127 0.6062859 0.5940976 0.5786550 0.5641786
[11,] 0.6868007 0.6853770 0.6859270 0.6866988 0.6853448 0.6846101 0.6827781 0.6794126 0.6729092 0.6651338 0.6538597 0.6419378 0.6294640 0.6175281 0.6022374 0.5879396
[12,] 0.7085880 0.7075222 0.7085802 0.7098426 0.7089146 0.7086329 0.7072312 0.7042507 0.6980663 0.6905747 0.6794518 0.6676412 0.6552266 0.6433555 0.6280108 0.6136917
[13,] 0.7212243 0.7206345 0.7222972 0.7241506 0.7221679 0.7217717 0.7210329 0.7186978 0.7131606 0.7050440 0.6945385 0.6821396 0.6703109 0.6590131 0.6441902 0.6304041
[14,] 0.7337044 0.7335628 0.7352420 0.7370655 0.7349415 0.7344243 0.7343182 0.7325988 0.7276789 0.7201716 0.7101945 0.6972348 0.6848745 0.6741190 0.6597882 0.6465053
[15,] 0.7493666 0.7495953 0.7517682 0.7540732 0.7524023 0.7516965 0.7520686 0.7507978 0.7451668 0.7381019 0.7284734 0.7158295 0.7037343 0.6932410 0.6790926 0.6660129
[16,] 0.7706182 0.7710999 0.7736523 0.7763244 0.7749522 0.7745699 0.7752431 0.7742282 0.7687794 0.7618609 0.7522562 0.7395995 0.7274505 0.7155829 0.7013638 0.6882421
[17,] 0.7803030 0.7812200 0.7831022 0.7856509 0.7843693 0.7845955 0.7850404 0.7837750 0.7779231 0.7706282 0.7606613 0.7487557 0.7373057 0.7261190 0.7114190 0.6976901
[18,] 0.7906433 0.7916429 0.7940141 0.7966414 0.7958510 0.7961459 0.7963319 0.7956006 0.7902802 0.7828238 0.7733522 0.7619074 0.7508756 0.7392832 0.7249966 0.7116903
[19,] 0.7919000 0.7931189 0.7957563 0.7985098 0.7978585 0.7983715 0.7983399 0.7983621 0.7931792 0.7851142 0.7751211 0.7636237 0.7535494 0.7428821 0.7288349 0.7156631
[20,] 0.8024880 0.8037538 0.8067246 0.8094977 0.8086917 0.8092999 0.8096142 0.8094660 0.8046137 0.7968630 0.7867842 0.7755396 0.7656905 0.7548179 0.7409690 0.7280063
 [ reached getOption("max.print") -- omitted 30 rows ]

$optimalScale
[1] 2500
```

a more interactive demo is provided in the package vignette:

```
vignette("MGC Statistic", package="MGC")
```



# Usage

Instructions for usage of the `MGC` statistic can be invoked from the `R` terminal window:

```
help(MGC)
```

which produces the `man` page:

```
The main function that computes the MGC measure between two datasets: It first computes all local correlations, then use the maximal statistic among all local correlations based on thresholding.

Description

The main function that computes the MGC measure between two datasets: It first computes all local correlations, then use the maximal statistic among all local correlations based on thresholding.

Usage

mgc.sample(A, B, option = "mgc")
Arguments

+ A	is interpreted as:
a [nxn] distance matrix, A is a square matrix with zeros on diagonal
a [nxd] data matrix, Otherwise
+ B	is interpreted as:
a [nxn] distance matrix, B is a square matrix with zeros on diagonal
a [nxd] data matrix, Otherwise
+ option='mgc'	is a string that specifies which global correlation to build up-on.
    + 'mgc' use the MGC global correlation.
    + 'dcor' use the dcor global correlation.
    + 'mantel' use the mantel global correlation.
    + 'rank' use the rank global correlation.

and Returns:
+ statMGC is the sample MGC statistic within [-1,1];

+ localCorr consists of all local correlations by double matrix index;

+ optimalScale the estimated optimal scale in matrix single index.

Author(s)

C. Shen
```

The discriminability statistic can be invoked as follows:

```
help(discr.discr)
```

and shows:

```
Description

A function for computing the discriminability from a distance matrix and a set of associated labels.

Usage

discr.discr(X, ids, thresh = 0, verbose = FALSE)
Arguments

+ X	is interpreted as:
    + a [n x n] distance matrix if X is a square matrix with zeros on diagonal
    + a [n x d] data matrix, Otherwise
+ ids	[n] is a vector containing the labels for our n observations.
+ remove_outliers=TRUE	boolean indicating whether to ignore observations with rdf below a certain cutoff.
+ thresh=0	the threshold below which to ignore observations. If thresh > 0, ignores observations where the rdf is < thresh in the discriminability computation.
+ verbose=FALSE	a boolean indicating whether to:
    + TRUE print output to console
    + FALSE Do not print output to console

Returns
+ discr the discriminability statistic.

Author(s)

Eric Bridgeford and Gregory Kiar
```

# Pseudocode

Pseudocode for the meethods employed in the `MGC` package can be found on the [arXiv - MGC](https://arxiv.org/abs/1609.05148) in Appendix C (starting on page 30). 
